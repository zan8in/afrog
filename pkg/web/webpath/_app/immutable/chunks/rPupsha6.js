import{g as i,a as u}from"./Dcjaah1X.js";const p="/api";class r extends Error{constructor(t,e,s){super(s),this.status=t,this.response=e,this.name="ApiError"}}class l{baseUrl;constructor(t=p){this.baseUrl=t}getBaseUrl(){return this.baseUrl}async request(t,e={}){const s=`${this.baseUrl}${t}`,a=i(),o={headers:{"Content-Type":"application/json",...e.headers},...e};a&&(o.headers={...o.headers,Authorization:`Bearer ${a}`});try{const n=await fetch(s,o);if(n.status===401)throw u.removeToken(),new r(401,null,"登录过期，请重新登录");if(!n.ok){const c=await n.json().catch(()=>({}));throw new r(n.status,c,c.message||`HTTP ${n.status}: ${n.statusText}`)}return await n.json()}catch(n){throw n instanceof r||n instanceof Error&&n.name==="AbortError"?n:new r(0,null,"网络错误，请检查连接后重试")}}post(t,e){return this.request(t,{method:"POST",body:e?JSON.stringify(e):void 0})}get(t){return this.request(t,{method:"GET"})}getWithOptions(t,e){return this.request(t,{method:"GET",...e||{}})}postWithOptions(t,e,s){return this.request(t,{method:"POST",body:e?JSON.stringify(e):void 0,...s||{}})}put(t,e){return this.request(t,{method:"PUT",body:e?JSON.stringify(e):void 0})}delete(t){return this.request(t,{method:"DELETE"})}async login(t){return this.post("/login",{password:t})}async loadVulns(){return this.get("/vulns")}async loadPocsStats(){return this.get("/pocs/stats")}async loadReports(t){const e=new URLSearchParams;t?.page&&e.set("page",String(t.page)),t?.page_size&&e.set("page_size",String(t.page_size)),t?.keyword&&e.set("keyword",t.keyword),t?.severity&&e.set("severity",t.severity);const s=e.toString()?`/reports?${e.toString()}`:"/reports";return this.get(s)}async getReportDetail(t,e={expand:"all"}){const s=new URLSearchParams;e.expand&&s.set("expand",e.expand);const a=`/reports/detail/${t}${s.toString()?"?"+s.toString():""}`;return this.get(a)}async getPocYamlContent(t){try{const e=await fetch(`${this.baseUrl}/pocs/yaml/${t}`,{method:"GET",headers:{Authorization:`Bearer ${i()}`,"Content-Type":"application/json"}});if(!e.ok)throw new r(e.status,null,`HTTP ${e.status}`);return{success:!0,message:"POC YAML内容获取成功",data:await e.text()}}catch(e){throw e instanceof r?e:new r(0,e,"网络错误，请检查连接后重试")}}async getPocContent(t){try{const e=await fetch(`${this.baseUrl}/reports/poc/${t}`,{method:"GET",headers:{Authorization:`Bearer ${i()}`,"Content-Type":"application/json"}});if(!e.ok)throw new r(e.status,null,`HTTP ${e.status}`);return{success:!0,message:"POC内容获取成功",data:await e.text()}}catch(e){throw e instanceof r?e:new r(0,e,"网络错误，请检查连接后重试")}}async createPoc(t){return this.post("/pocs/create",t)}async updatePoc(t,e){return this.post(`/pocs/update/${t}`,e)}async deletePoc(t){return this.delete(`/pocs/${t}`)}async validatePoc(t){return this.post("/pocs/validate",t)}async getAssetSets(){return this.get("/assets/sets")}async getAssetSetItems(t){return this.get(`/assets/sets/${t}`)}async createAssetSet(t){return this.post("/assets/sets",t)}async importIntoAssetSet(t,e){return this.post(`/assets/sets/${t}/import`,e)}async updateAssetSet(t,e){return this.put(`/assets/sets/${t}`,e)}async deleteAssetSet(t){return this.delete(`/assets/sets/${t}`)}async searchAssets(t){const e=new URLSearchParams;return t&&e.set("query",t),this.get(`/assets/search?${e.toString()}`)}async exportAssetsJson(t){const e=new URLSearchParams;return t?.length&&e.set("ids",t.join(",")),this.get(`/assets/export?${e.toString()}`)}async createScan(t,e){return this.postWithOptions("/scans",t,e)}async getScanStatus(t){return this.get(`/scans/${t}/status`)}async stopScan(t){return this.post(`/scans/${t}/stop`)}async pauseScan(t){return this.post(`/scans/${t}/pause`)}async resumeScan(t){return this.post(`/scans/${t}/resume`)}async openScanEvents(t,e){const s=`${this.baseUrl}/scans/${t}/events`,a=i(),o={...e?.headers,Accept:"text/event-stream, application/x-ndjson, application/json"};return a&&(o.Authorization=`Bearer ${a}`),await fetch(s,{method:"GET",...e,headers:o})}openScanEventsSSE(t){const e=new URLSearchParams,s=i();s&&e.set("token",s);const a=`${this.baseUrl}/scans/${t}/events${e.toString()?`?${e.toString()}`:""}`;return new EventSource(a,{withCredentials:!1})}async getServerInfo(t){return this.getWithOptions("/server/info",t)}async listInstances(){return this.get("/instances")}async forceStopInstance(t,e){return this.post(`/instances/${t}/force-stop`,e||{})}}const g=new l;export{r as A,g as a};
