id: mysql-detect

info:
  name: MySQL Dectect
  author: zan8in
  severity: info
  verified: true
  description: |-
    MySQL instance was detected
  tags: network,db,mysql,fingerprint
  created: 2024/01/05

set:
  host: request.url.host
rules:
  r0:
    request:
      type: tcp
      host: "{{host}}"
      steps:
        - write:
            data: "\n"
        - read:
            read-size: 4096
            read-timeout: 3
    expression: |
      response.raw.ibcontains(b"mariadb") ||
      response.raw.ibcontains(b"mysql") ||
      response.raw.ibcontains(b"mysql_native_password") ||
      "\\x0a[0-9]\\.[0-9]{1,2}\\.[0-9]{1,2}".bmatches(response.raw)
    extractors:
      - type: regex
        extractor:
          ext: '"\\x0a(?P<mysql>[0-9]\\.[0-9]{1,2}\\.[0-9]{1,2})".bsubmatch(response.raw)'
          mysql: ext["mysql"]

expression: r0()
