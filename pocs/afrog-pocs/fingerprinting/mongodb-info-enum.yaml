id: mongodb-info-enum

info:
  name: MongoDB Information - Detect
  author: pussycat0x
  severity: info
  description: |-
    MongoDB build and server information was detected.
  reference:
    - https://nmap.org/nsedoc/scripts/mongodb-info.html
  tags: network,mongodb,enum,fingerprint
  created: 2024/01/05

set:
  host: request.url.host
rules:
  r0:
    request:
      type: tcp
      host: "{{host}}"
      steps:
        - write:
            data: "3b0000003c300000ffffffffd40700000000000061646d696e2e24636d640000000000ffffffff14000000106275696c64696e666f000100000000"
            data-type: hex
        - read:
            read-size: 20480
            read-timeout: 3
    expression: response.raw.ibcontains(b"version") && response.raw.ibcontains(b"maxBsonObjectSize")
    extractors:
      - type: regex
        extractor:
          ext: '"version[^0-9]{0,20}(?P<mongodb>[0-9]+\\.[0-9]+\\.[0-9]+(?:\\.[0-9]+)?)[^a-zA-Z0-9]{0,20}gitVersion".bsubmatch(response.raw)'
          mongodb: ext["mongodb"]
expression: r0()
