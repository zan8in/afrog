id: dameng-detect

info:
  name: 达梦数据库
  author: zan8in
  severity: info
  verified: true
  description: |-
    默认端口 5236 默认密码  达梦数据库默认用户密码SYSDBA:SYSDBA
    fofa: protocol="dameng"
    zoomeye: app:"DMSQL"
  reference:
    - https://www.dameng.com/
  tags: network,db,dameng,fingerprint
  created: 2023/12/22

set:
  host: request.url.host
rules:
  r0:
    request:
      type: tcp
      host: "{{host}}"
      steps:
        - write:
            data: "00000000c8005100000000000000000000000099000000000000000001020000000000000000000000000000000000000000000000000000000000000000000008000000382e312e312e34390040000000068149bbe004a62fb45552831704c802d4d802b4579cb045b3c6100880725ececf148a7c9205047caccadfef5ff264460d11092a3b483bf9d24382dea1dc43e7"
            data-type: hex
        - read:
            read-size: 8192
            read-timeout: 3
    expression: response.body.bcontains(b"\x00\x00\x00\x00\xe4\x00") || response.body.bcontains(b"\x40\x00\x00\x00")
    extractors:
      - type: regex
        extractor:
          ext: '"(?P<dameng>[0-9]\\.[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{1,3})".bsubmatch(response.raw)'
          dameng: ext["dameng"]
expression: r0()
