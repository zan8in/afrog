id: tomcat-manager

info:
  name: Apache Tomcat Manager Path Normalization Panel - Detect
  author: brenocss,organiccrap
  severity: info
  verified: true
  description: |-
    Apache Tomcat Manager Path Normalization login panel was discovered via path normalization. Normalizing a path involves modifying the string that identifies a path or file so that it conforms to a valid path on the target operating system.
  reference:
    - https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf
  tags: panel,tomcat,apache,misconfig
  created: 2023/10/14

set:
  randstr: randomLowercase(10)
rules:
  r0:
    stop_if_match: true
    brute:
      mode: sniper
      commit: winner
      continue: false
      p:
        - /manager/html
        - /host-manager/html
    request:
      method: GET
      path: "{{p}}"
    expression: (response.status == 401 || response.status == 200) && (response.body.bcontains(b'Apache Tomcat') || response.body.bcontains(b'Tomcat Manager'))
  r1:
    stop_if_match: true
    brute:
      mode: sniper
      commit: winner
      continue: false
      p:
        - "/..;/manager/html"
        - "/..;/..;/manager/html;/"
        - "/..;/host-manager/html"
        - "/..;/..;/host-manager/html;/"
        - "/{{randstr}}/..;/manager/html"
        - "/{{randstr}}/..;/host-manager/html"
    request:
      method: GET
      path: "{{p}}"
    expression: response.status == 403 && response.body.bcontains(b'username="tomcat" password="s3cret"') && response.body.bcontains(b'manager-gui')
expression: r0() || r1()
