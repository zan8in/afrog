id: jira-unauthenticated

info:
  name: Jira Unauthenticated Admin Projects
  author: TESS
  severity: info
  verfied: true
  description: |-
    Jira Unauthenticated Admin Projects
  tags: jira,unauth
  created: 2023/07/07

rules:
  r0:
    stop_if_match: true
    brute:
      mode: pitchfork
      commit: winner
      continue: false
      p:
        - /rest/menu/latest/admin
        - /rest/api/2/dashboard?maxResults=100
        - /rest/api/2/projectCategory?maxResults=1000
        - /rest/api/2/project?maxResults=100
        - /rest/api/2/resolution
        - /rest/api/2/screens
        - /secure/popups/UserPickerBrowser.jspa
      kind:
        - admin_menu
        - dashboard
        - project_category
        - project
        - resolution
        - screens
        - user_picker
    request:
      method: GET
      path: "{{p}}"
    expression: |
      (kind == "user_picker" && response.body.bcontains(b'user-picker')) ||
      (response.status == 200 && (
        (kind == "admin_menu" && response.body.bcontains(b'key') && response.body.bcontains(b'link') && response.body.bcontains(b'label') && response.body.bcontains(b'self') && response.headers["set-cookie"].icontains("atlassian.xsrf.token")) ||
        (kind == "dashboard" && response.body.bcontains(b'dashboards') && response.body.bcontains(b'startAt') && response.body.bcontains(b'maxResults')) ||
        (kind == "project_category" && response.body.bcontains(b'self') && response.body.bcontains(b'description') && response.body.bcontains(b'name') && response.headers["set-cookie"].icontains("atlassian.xsrf.token")) ||
        (kind == "project" && response.body.bcontains(b'projects') && response.body.bcontains(b'startAt') && response.body.bcontains(b'maxResults')) ||
        (kind == "resolution" && response.body.bcontains(b'self') && response.body.bcontains(b'description') && response.body.bcontains(b'name') && response.headers["set-cookie"].icontains("atlassian.xsrf.token")) ||
        (kind == "screens" && response.body.bcontains(b'\"id\":') && response.body.bcontains(b'\"name\":') && response.body.bcontains(b'\"description\":'))
      ))
  r1:
    stop_if_match: true
    request:
      method: GET
      path: /rest/config/1.0/directory
      follow_redirects: true
    expression: response.status == 200 && response.body.bcontains(b'jaxbDirectoryContents')
expression: r0() || r1()
