id: CVE-2020-13921

info:
  name: SkyWalking SQL Injection
  author: zan8in
  severity: high
  verified: true
  description: |-
    SkyWalking SQL Injection
    fofa: app="APACHE-Skywalking"
  reference:
    - https://github.com/apache/skywalking/pull/4639
  tags: cve,cve2020,sqli,skywalking,apache
  created: 2024/04/18

rules:
  r0:
    request:
      method: POST
      path: /graphql
      headers:
        Content-Type: application/json
      body: |
        {"query":"query version { version }","variables":{}}
    expression: response.status == 200 && response.body.bcontains(b'"data":') && response.body.bcontains(b'"version":')
    output:
      search: '"\"version\":\"(?P<version>[0-9]{1,2}\\.[0-9]{1,2}(\\.[0-9]{1,2})?)".bsubmatch(response.body)'
      version: search["version"]
expression: |
  r0() && 
  (versionCompare(string(version),"<","7.0.0") ||
      (versionCompare(string(version),">","6.0.0") && versionCompare(string(version),"<","6.6.0")) ||
      (versionCompare(string(version),">","8.0.0") && versionCompare(string(version),"<","8.0.1")))
